FROM python:3.9-slim AS base

################################################################################
#                                    server                                    #
################################################################################


#------------------------------------------------------------------------------#
#                               Dependency Stage                               #
#------------------------------------------------------------------------------#

FROM base AS dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir --upgrade -r requirements.txt


#------------------------------------------------------------------------------#
#                                Runtime Stage                                 #
#------------------------------------------------------------------------------#

FROM dependencies AS runtime
EXPOSE 80
COPY . .
CMD ["fastapi", "run", "--proxy-headers", "--port", "80"]
